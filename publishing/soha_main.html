<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>상주시 소/하/천 관제</title>
    <!-- Bootstrap (선택) -->
    <!--<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">-->
  <!-- Chart.js -->
    <link rel="stylesheet" href="./css/main-style.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@1.3.9/dist/web/static/pretendard.css">
<script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

</head>

<body>
  <a class="skip-link" href="#main">본문 바로가기</a>

<header class="topbar" role="banner">
  <div class="topbar__inner">
    <div class="brand" aria-label="상주시 소/하/천">
      <div class="brand__logo" aria-hidden="true">
        <a href="soha_main.html"><img src="img/logo-sangju.png"></a>
      </div>
    </div>

    <!-- ✅ 햄버거 버튼 (이것만 menuToggle) -->
    <button class="btn btn--ghost topbar__menuBtn"
            type="button"
            id="menuToggle"
            aria-controls="topbarActions"
            aria-expanded="false"
            aria-label="메뉴">
      <i data-lucide="menu" class="btn__icon"></i>
      <span class="btn__text">메뉴</span>
    </button>

    <!-- ✅ 드롭다운 메뉴 -->
    <div class="search__actions" id="topbarActions" role="group" aria-label="바로가기">
      <button class="btn btn--ghost" type="button">
        <i data-lucide="waves" class="btn__icon"></i>
        <span class="btn__text">수위</span>
      </button>

      <button class="btn btn--ghost" type="button">
        <i data-lucide="cctv" class="btn__icon"></i>
        <span class="btn__text">CCTV</span>
      </button>

      <button class="btn btn--primary" type="button"   onclick="location.href='report.html'">
        <i data-lucide="file-text" class="btn__icon"></i>
        <span class="btn__text">보고서</span>
      </button>
    </div>
  </div>
</header>

  <main id="main" class="layout" role="main">
    <section class="map" aria-label="지도 영역">


      <!-- 지도: API 대신 이미지 -->
      <div id="naverMap" class="map__canvas map__canvas--image" aria-label="지도 이미지">
        <img class="map__img" src="./img/map.png" alt="지도 이미지" />
        <!-- 마커 레이어 -->
        <div class="map__markers" id="mapMarkers" aria-label="지도 마커 레이어"></div>
      </div>

      <!-- 가운데 팝업 -->
      <section class="popup" id="devicePopup" aria-label="장비 요약 팝업" hidden>
        <div class="popup__head">
          <div class="popup__title">
          <i data-lucide="waves" class="btn__icon"></i>
            <strong id="popupName">장비명</strong>
          </div>
         
       <div class="popup__meta">
  <div class="popup__net" id="popupNet">
    <span class="popup__dot" id="popupNetDot"></span>
    <span id="popupNetText">Operational</span>
  </div>

  <!-- ✅ 수위 뱃지(정상/주의/경계/심각) -->
  <div class="popup__waterBadge" id="popupWaterBadge">정상 (&lt;70%)</div>
</div>


        </div>

        <p class="popup__addr" id="popupAddr">주소</p>

        <div class="popup__body">
          <div class="popup__map">
          <figure class="thumb">
            <img id="popupImg" alt="현장 이미지" />
          </figure>

          <div class="popup__right">
            <dl class="kv">
               <div class="kv__row"><dt><span class="mr-5 sq sq--unk "></span>함체 높이</dt><dd id="popupH">-</dd></div>
              <div class="kv__row"><dt><span class="mr-5 sq sq--unk "></span>현재 수위(%)</dt><dd id="popupWater">-</dd></div>
              <div class="kv__row"><dt><span class="mr-5 sq sq--caution "></span>주의(70%)</dt><dd id="popupLv70">-</dd></div>
              <div class="kv__row"><dt><span class="mr-5 sq sq--warm "></span>경계(80%)</dt><dd id="popupLv80">-</dd></div>
              <div class="kv__row"><dt><span class="mr-5 sq sq--crit "></span>심각(90%)</dt><dd id="popupLv90">-</dd></div>
            </dl>
          </div>
          </div>
          <div>
                      <div class="waterbar" aria-label="실시간 수위">
              <div class="waterbar__label">
                <span>수위 게이지</span>
                <span class="waterbar__pct" id="waterPctText">0%</span>
              </div>
              <div class="waterbar__track" role="img" aria-label="수위 진행 바">
                <div class="waterbar__fill" id="waterFill" style="width:0%"></div>
                <div class="waterbar__tick waterbar__tick--70" title="70%"></div>
                <div class="waterbar__tick waterbar__tick--80" title="80%"></div>
                <div class="waterbar__tick waterbar__tick--90" title="90%"></div>
              </div>
              <div class="waterbar__legend">
                <span class="lg lg--ok">정상(&lt;70)</span>
                <span class="lg lg--caution">주의(70)</span>
                <span class="lg lg--warn">경계(80)</span>
                <span class="lg lg--crit">심각(90)</span>
              </div>
            </div>
            </div>
        </div>

     <div class="popup__foot">
<button class="btn btn--ghost" type="button" id="btnClosePopup">
  <i data-lucide="x" class="btn__icon"></i>
  <span>닫기</span>
</button>

  <button class="btn btn--primary" type="button" id="btnDetail">
    <i data-lucide="search" class="btn__icon"></i>
    <span>상세보기</span>
  </button>
</div>

      </section>
    </section>


    <!-- 우측 목록 -->
    <aside class="sidebar" aria-label="장비 목록">
      <div class="sidebar__head">
        <div class="sidebar__title">
          <div>
            <span class="panel__icon" aria-hidden="true">
              <i data-lucide="list-tree" class="btn__icon"></i>
            </span>
            <h2>장비 목록</h2>
          </div>
        </div>
        <div class="sidebar__count"><span id="totalCount">0</span>개</div>
      </div>
      <div class="list" id="deviceList" role="list"></div>
    </aside>

              <!-- 하단 상태 패널 -->
      <section class="bottom">
        <article class="panel" aria-label="장비 상태">
          <div class="panel__head">
            <div>
            <span class="panel__icon" aria-hidden="true">
               <i data-lucide="activity" class="btn__icon"></i>
            </span>
            <h2 class="panel__title">장비 상태</h2>
            </div>
         
            <div class="mini-stats" aria-label="요약">
              <span class="dot dot--ok"></span><span id="countOk">0</span>
              <span class="dot dot--warn"></span><span id="countWarn">0</span>
              <span class="dot dot--crit"></span><span id="countCrit">0</span>
              <span class="dot dot--unk"></span><span id="countUnk">0</span>
            </div>
          </div>

          <div class="bar" role="img" aria-label="상태 비율 막대">
            <div class="bar__seg bar__seg--unk" id="barUnk" style="width:0%"></div>
            <div class="bar__seg bar__seg--ok" id="barOk" style="width:0%"></div>
            <div class="bar__seg bar__seg--warn" id="barWarn" style="width:0%"></div>
            <div class="bar__seg bar__seg--crit" id="barCrit" style="width:0%"></div>
          </div>

          <div class="bar-legend">
            <span>Unknown: <strong id="pctUnk">0%</strong></span>
            <span>정상: <strong id="pctOk">0%</strong></span>
            <span>센서오류: <strong id="pctWarn">0%</strong></span>
            <span>네트워크: <strong id="pctCrit">0%</strong></span>
          </div>
        </article>

        <article class="panel" aria-label="상태 안내">
          <div class="panel__head">
            <div>
              <span class="panel__icon" aria-hidden="true">
                 <i data-lucide="alert-circle" class="btn__icon"></i>
              </span>
              <h2 class="panel__title">상태 안내</h2>
            </div>
          </div>
          <div class="legend">
            <ul>
            <li><span class="dot dot--ok"></span> 정상:  통신/센서 정상</li>
            <li><span class="dot dot--caution"></span> 센서오류 :  값 오류</li>
            <li><span class="dot dot--crit"></span>네트워크 :  통신 실패</li>
            <li><span class="dot dot--unk"></span> Unknown: 수신 없음</li>
            </ul>
          </div>
        </article>
      </section>
  </main>

  <script src="./js/base.js" defer></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    lucide.createIcons();
  });
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const btn = document.getElementById("menuToggle");
  const menu = document.getElementById("topbarActions");
  if (!btn || !menu) return;

  btn.addEventListener("click", function (e) {
    e.preventDefault();
    e.stopPropagation();
    menu.classList.toggle("is-open");
    btn.setAttribute("aria-expanded", menu.classList.contains("is-open"));
  });

  document.addEventListener("click", function (e) {
    if (!menu.classList.contains("is-open")) return;
    if (menu.contains(e.target) || btn.contains(e.target)) return;
    menu.classList.remove("is-open");
    btn.setAttribute("aria-expanded", "false");
  });
});
</script>
</body>
</html>
